<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Panel Admin Rifa</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <style>
    body { font-family: Arial, sans-serif; background: #f1f8e9; padding: 20px; }
    h1 { text-align: center; color: #1b5e20; }
    .boleto { background: #fff; padding: 15px; margin-bottom: 12px; border-radius: 8px; box-shadow: 0 2px 6px rgba(0,0,0,0.1); }
    .boleto.pagado { border-left: 6px solid #c62828; }
    button { margin-top: 8px; background: #2e7d32; color: white; border: none; padding: 8px 14px; border-radius: 6px; cursor: pointer; }
    #volver { display: block; margin: 20px auto; background: #0b640b; color: white; padding: 10px 20px; border-radius: 20px; text-decoration: none; text-align: center; width: fit-content; }
  </style>
</head>
<body>

<a id="volver" href="index.html">‚¨Ö Volver a inicio</a>
<h1>Panel de Administraci√≥n - Boletos Pagados</h1>

<div id="contenedor-boletos"></div>

<!-- Script -->
<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-app.js";
  import { getFirestore, collection, getDocs } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-firestore.js";
  import html2canvas from "https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js";

  const firebaseConfig = {
    apiKey: "AIzaSyC-9BVF6sfbA1IcmawTtxFiwHOyHv0Qa3g",
    authDomain: "rifas-con-causa.firebaseapp.com",
    projectId: "rifas-con-causa",
    storageBucket: "rifas-con-causa.appspot.com",
    messagingSenderId: "347417635634",
    appId: "1:347417635634:web:3ddab8921d26707910452b"
  };

  const app = initializeApp(firebaseConfig);
  const db = getFirestore(app);

  async function mostrarBoletosPagados() {
    const contenedor = document.getElementById("contenedor-boletos");
    const snapshot = await getDocs(collection(db, "boletos"));

    snapshot.forEach(doc => {
      const data = doc.data();
      if (data.estado === "pagado") {
        const div = document.createElement("div");
        div.className = "boleto pagado";
        div.innerHTML = `
          <p><strong>Boleto #${data.idboleto}</strong></p>
          <p>Nombre: ${data.nombre}</p>
          <p>Tel√©fono: ${data.telefono}</p>
          <p>Poblaci√≥n: ${data.poblacion}</p>
          <button onclick="generarRecibo('${data.idboleto}', '${data.nombre}', '${data.telefono}', '${data.poblacion}')">üìÑ Descargar recibo</button>
          <div id="recibo-${data.idboleto}" style="display:none; padding:15px; background:#fff; color:#000; width:300px; border:2px solid #2e7d32;">
            <h3 style="text-align:center;">RECIBO DE DONACI√ìN</h3>
            <p><strong>Folio:</strong> ${data.idboleto}</p>
            <p><strong>Nombre:</strong> ${data.nombre}</p>
            <p><strong>Tel√©fono:</strong> ${data.telefono}</p>
            <p><strong>Poblaci√≥n:</strong> ${data.poblacion}</p>
            <p style="margin-top:20px; text-align:center;">Gracias por apoyar esta causa.</p>
          </div>
        `;
        contenedor.appendChild(div);
      }
    });
  }

  window.generarRecibo = async (id, nombre, telefono, poblacion) => {
    const recibo = document.getElementById(`recibo-${id}`);
    recibo.style.display = "block";
    const canvas = await html2canvas(recibo);
    const link = document.createElement("a");
    link.href = canvas.toDataURL("image/png");
    link.download = `recibo-${id}.png`;
    link.click();
    recibo.style.display = "none";
  };

  mostrarBoletosPagados();
</script>
</body>
</html>