<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="utf-8"/>
<title>Panel Admin - Rifas con Causa</title>
 <style>
#contadorActualizacion {
  position: fixed;
  top: 10px;
  right: 20px;
  background: #e0f7fa;
  padding: 6px 12px;
  border-radius: 6px;
  font-size: 14px;
  font-weight: bold;
  color: #00796b;
  z-index: 9999;
  display: none;
}
</style>

<link href="favicon.ico" rel="icon" type="image/x-icon"/>
 <style>
#contadorActualizacion {
  position: fixed;
  top: 10px;
  right: 20px;
  background: #def7fa;
  padding: 6px 12px;
  border-radius: 6px;
  font-size: 14px;
  font-weight: bold;
  color: #08796b;
  z-index: 9999;
  display: none;
  transition: background 0.3s, color 0.3s;
}
#contadorActualizacion.alarma {
  background: #ff4d4d;
  color: white;
}
</style>

</head>
<body>
 <div id="contadorActualizacion">Actualizaci√≥n en: 40s</div>

<h1 id="tituloPanel">Panel de Control</h1>
<p style="font-size: 0.95em; margin-top: -10px; margin-bottom: 20px; line-height: 1.4; color: #333;">
‚ö†Ô∏è <strong>INSTRUCCIONES IMPORTANTES PARA LOS ROLES:</strong><br/>
‚Ä¢ Toma en cuenta que al cambiar un estado a <strong>"PAGADO"</strong>, <u>ya no podr√°s devolverlo a otro estado</u>.<br/>
‚Ä¢ Deber√°s comunicarte con el <strong>ADMIN</strong> para que realice la correcci√≥n si fue un error.<br/>
‚Ä¢ Y recuerda que si el cliente paga por <strong>transf. o deposito a la cuenta del admin</strong>,<br/>
el cambio de estado <u>debe hacerlo el ADMIN</u>,<br/>
ya que ese monto no entrar√° a tu cuenta de ingresos.
</p>
<button class="solo-admin" onclick="exportarExcel()" style="margin-top: 15px; display: none;">
üì• Exportar a Excel
</button><div class="solo-admin" style="margin-top: 10px; display: none;">
<label for="precioUnitario"><strong>üí∞ Precio unitario por boleto:</strong></label>
<input id="precioUnitario" min="0" step="1" style="width: 100px;" type="number" value="0"/>
</div><table border="1" id="tablaBoletos">
<thead>
<tr>
<th>Boleto</th>
<th>Nombre</th>
<th>Tel√©fono</th>
<th>Poblaci√≥n</th>
<th>Estado</th>
<th>Fecha</th>
<th>Modificado por</th>
<th>Forma Pago</th>
<th>Acci√≥n</th>
<th>Comprobante</th>
</tr>
  <div id="lineaOport1" style="position:absolute; top:890px; left:90px; font-size:22px;"></div>
  <div id="lineaOport2" style="position:absolute; top:925px; left:90px; font-size:22px;"></div>
  <!-- Mensaje VIP -->
  <div style="position:absolute; top:980px; left:90px; font-size:16px; width:580px; line-height:1.3;">

    <div>üéÅ 3.er Premio adicional: ES UN REGALO PARA NUESTROS COLABORADORES VIP. Bicicleta Mercurio 26</div>
    <div>üì¢ Este premio para quien compre 3 boletos o mas. y comparta en Facebook, SI RESULTA GANADOR (TODO PARA UN SOLO GANADOR)</div>
    <div>üì¶ ademas se gana Env√≠o GRATIS a todo M√©xico.</div>
    <div>üìå Recuerda poner tu n√∫mero participante de tu serie participante en la publicaci√≥n. Es minimo una por serie al dia. guarda captura para reclamar el regalo</div>
  </div>
  <!-- Frase final -->
<div style="position:absolute; top:1160px; left:140px; font-size:28px; font-style:italic; font-weight:bold;">
  ¬°Gracias por tu apoyo y buena suerte!
</div>

<div style="position:absolute; top:1200px; left:140px; font-size:24px;">
  Bases del sorteo y actualizaciones disponibles en la pagina.
</div>

<!-- üì§ Bot√≥n de WhatsApp -->
<div id="btnWhatsapp" style="display:none; margin-top:20px;">
  <a id="waLink" href="#" target="_blank" style="background-color:#25D366; padding:10px 20px; color:white; text-decoration:none; font-weight:bold; border-radius:5px;">
    üì§ Enviar por WhatsApp
  </a>
</div>

<!-- Script para generar imagen -->
<script src="https://html2canvas.hertzen.com/dist/html2canvas.min.js"></script>
<script>
function generarBoleto(nombre, poblacion, folio, oportunidades, telefono) {

  document.getElementById("nombreBoleto").innerText = nombre;
  document.getElementById("poblacionBoleto").innerText = poblacion;
  document.getElementById("folioBoleto").innerText = "BOLETO # " + folio;
  document.getElementById("lineaOport1").innerText = oportunidades.slice(0, 5).join("   ");
  document.getElementById("lineaOport2").innerText = oportunidades.slice(5, 10).join("   ");

  const boleto = document.getElementById("boletoPreview");
  boleto.style.display = "block";

  html2canvas(boleto, { useCORS: true }).then(canvas => {
    const link = document.createElement("a");
    link.download = `BOLETO-${folio}.png`;
    link.href = canvas.toDataURL();
    link.click();
    boleto.style.display = "none";

    // WhatsApp link
    const mensaje = `üéâ ¬°Gracias por apoyar la causa! Aqu√≠ tienes tu boleto #${folio} de la rifa de bicicletas.\n\n‚úÖ Participas con 10 oportunidades.\n\nM√°s informaci√≥n en: https://rifas-con-causa.github.io/BICIS-MONTANA-EQUIPADAS/index.html`;
    const numeroLimpio = telefono.replace(/\D/g, ""); // Solo n√∫meros

const waUrl = `https://wa.me/52${numeroLimpio}?text=${encodeURIComponent(mensaje)}`;

    document.getElementById("waLink").href = waUrl;
    document.getElementById("btnWhatsapp").style.display = "block";
   window.open(waUrl, "_blank");  // Esto abre autom√°ticamente el WhatsApp web

  });
}
</script>
<script>
// üé® Activar color rosa al editar y restaurar seg√∫n estado al salir
document.addEventListener("DOMContentLoaded", () => {
  const tabla = document.getElementById("tablaBoletos");

  tabla.addEventListener("focusin", (e) => {
    const tr = e.target.closest("tr");
    if (tr) {
      tr.setAttribute("data-original-color", tr.style.backgroundColor); // opcional
      tr.style.background = "#ffe6f0"; // color rosa claro
      tr.style.color = "black";
    }
  });

  tabla.addEventListener("focusout", (e) => {
    const tr = e.target.closest("tr");
    const estado = tr?.querySelector("td:nth-child(5)")?.textContent?.toLowerCase();
    if (tr && estado) {
      switch (estado) {
        case "pagado":
          tr.style.background = "#e74c3c"; tr.style.color = "white";
          break;
        case "apartado":
          tr.style.background = "#f1c40f"; tr.style.color = "black";
          break;
        default:
          tr.style.background = "#2ecc71"; tr.style.color = "white";
      }
    }
  });
});
</script>

<script type="module">
let tiempoRestante = 180;
const contador = document.getElementById("contadorActualizacion");

setInterval(() => {
  const activo = document.activeElement;
  const esEditable = activo && (activo.tagName === 'INPUT' || activo.tagName === 'SELECT' || activo.tagName === 'TEXTAREA');

  tiempoRestante--;

  if (tiempoRestante <= 40) {
    contador.style.display = "block";
    contador.textContent = esEditable
      ? "‚è∏Ô∏è Editando..."
      : `Actualizaci√≥n en: ${tiempoRestante}s`;
  }

  if (tiempoRestante <= 0) {
    if (!esEditable) {
      cargarBoletos();
      console.log("üîÅ Tabla actualizada autom√°ticamente");
    } else {
      console.log("‚è∏Ô∏è Pausa: el usuario est√° interactuando");
    }
    tiempoRestante = 180;
    contador.style.display = "none";
  }
}, 1000);
</script>
<script type="module">
let tiempoRestante = 180;
let segundosSinMover = 0;
const contador = document.getElementById("contadorActualizacion");
let alarmaReproducida = false;

const audio = new Audio("https://notificationsounds.com/storage/sounds/file-sounds-1157-pristine.mp3");

</script>

</body>
</html>
