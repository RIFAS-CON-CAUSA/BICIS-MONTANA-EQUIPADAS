<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Panel Admin - Rifas con Causa</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <!-- (Estilos y estructura igual que antes) -->
</head>
<body>
  <!-- (Encabezados, filtros y tabla igual que antes) -->

<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-app.js";
  import { getFirestore, collection, getDocs, updateDoc, doc } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-firestore.js";

  const firebaseConfig = { /* tu config */ };
  const app = initializeApp(firebaseConfig);
  const db = getFirestore(app);

  const accesos = { /* tus accesos con nombres */ };

  let usuarioRol = null;
  let usuarioNombre = null;
  let datosBoletos = [];

  document.addEventListener("DOMContentLoaded", () => { /* login clave */ });
  async function cargarBoletos() { /* carga de boletos */ }
  function mostrarBoletos(lista) { /* renderiza tabla */ }

  window.cambiarEstado = async function(id, nuevoEstado) { /* actualiza estado */ };

  function exportarExcel() {
    let csv = "Boleto,Nombre,Teléfono,Población,Estado,Fecha,Modificado por,Forma de pago\n";
    datosBoletos.forEach(b => {
      csv += `#${b.boleto},"${b.nombre || ""}","${b.telefono || ""}","${b.poblacion || ""}","${b.estado}","${b.fecha ? new Date(b.fecha).toLocaleString() : ""}","${b.modificadoPor || ""}","${b.formaPago || ""}"\n`;
    });
    const blob = new Blob([csv], { type: "text/csv" });
    const url = URL.createObjectURL(blob);
    const a = document.createElement("a");
    a.href = url;
    a.download = `Boletos-Rifa-${new Date().toLocaleDateString()}.csv`;
    a.click();
    URL.revokeObjectURL(url);
  }

  function exportarExcelPagadosPorUsuario() {
    const pagadosUsuario = datosBoletos.filter(b => b.estado === "pagado" && b.modificadoPor === usuarioNombre);
    if (pagadosUsuario.length === 0) {
      alert("No tienes boletos pagados registrados.");
      return;
    }
    let csv = "Boleto,Nombre,Teléfono,Población,Estado,Fecha,Modificado por,Forma de pago\n";
    pagadosUsuario.forEach(b => {
      csv += `#${b.boleto},"${b.nombre || ""}","${b.telefono || ""}","${b.poblacion || ""}","${b.estado}","${b.fecha ? new Date(b.fecha).toLocaleString() : ""}","${b.modificadoPor || ""}","${b.formaPago || ""}"\n`;
    });
    const blob = new Blob([csv], { type: "text/csv" });
    const url = URL.createObjectURL(blob);
    const a = document.createElement("a");
    a.href = url;
    a.download = `Pagados-${usuarioNombre}-${new Date().toLocaleDateString()}.csv`;
    a.click();
    URL.revokeObjectURL(url);
  }

  // funciones filtrar, filtrarBusqueda, mostrarNotificacion...

</script>
</body>
</html>
