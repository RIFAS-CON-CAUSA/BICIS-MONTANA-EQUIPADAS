<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Panel Boletos - 1 al 100</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <style>
    body { font-family: Arial; text-align: center; background: #f4fff0; margin: 0; padding: 20px; }
    h1 { color: #2e7d32; margin-bottom: 5px; }
    .panel { display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 10px; margin-top: 20px; }
    .boleto { border: 2px solid #ccc; border-radius: 10px; padding: 10px; background: white; }
    .numeros { font-size: 12px; margin-bottom: 6px; color: #555; }
    button { padding: 8px; font-size: 15px; border: none; border-radius: 6px; cursor: pointer; color: white; width: 100%; transition: transform 0.2s; }
    button:hover { transform: scale(1.05); }
    .disponible { background-color: #2ecc71; }
    .apartado { background-color: #f1c40f; }
    .pagado { background-color: #e74c3c; }
    .volver, .buscar, .reporte { margin-top: 20px; display: inline-block; font-weight: bold; font-size: 15px; text-decoration: none; background: #1b5e20; color: white; padding: 10px 18px; border-radius: 25px; }
    .buscar { background: #1976d2; margin-left: 10px; }
    #reporteRepetidos, #busquedaResultado { display: none; margin-top: 20px; text-align: left; padding: 10px; background: #fff; border-radius: 10px; box-shadow: 0 0 8px rgba(0,0,0,0.1); }
  </style>
</head>
<body>

<a class="volver" href="index.html">‚¨Ö Volver a inicio</a>
<h1>RIFA ‚Äì ELIGE TU BOLETO</h1>
<p>Aqu√≠ tienes los 100 boletos</p>
<p style="margin-bottom:20px;">Verde: Disponible ¬∑ Amarillo: Apartado ¬∑ Rojo: Pagado</p>

<div id="panel" class="panel"></div>

<a class="volver" href="index.html">‚¨Ö Volver a inicio</a>
<p>Gracias por tu apoyo al deporte y los j√≥venes.<br>Mucha suerte, con un boleto ya est√°s dentro de los probables ganadores y nuevo ciclista.</p>

<a class="buscar" onclick="buscarNumero()">üîç Encuentra tu n√∫mero de la suerte</a>
<a class="buscar" onclick="pedirClaveBNR()">BNR</a>

<div id="busquedaResultado"></div>
<div id="reporteRepetidos"></div>

<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-app.js";
  import { getFirestore, collection, getDocs } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-firestore.js";

  const firebaseConfig = {
    apiKey: "AIzaSyC-9BVF6sfbA1IcmawTtxFiwHOyHv0Qa3g",
    authDomain: "rifas-con-causa.firebaseapp.com",
    projectId: "rifas-con-causa",
    storageBucket: "rifas-con-causa.appspot.com",
    messagingSenderId: "347417635634",
    appId: "1:347417635634:web:3ddab8921d26707910452b"
  };

  const app = initializeApp(firebaseConfig);
  const db = getFirestore(app);

  const panel = document.getElementById("panel");
  const oportunidadesGlobal = [];

  function generarOportunidades(num, base = 0) {
    const start = (num - 1) * 10 + base;
    const usados = new Set();
    while (usados.size < 10) {
      const n = String((start + Math.floor(Math.random() * 1000)) % 1000).padStart(3, '0');
      usados.add(n);
    }
    return [...usados];
  }

  for (let i = 1; i <= 100; i++) {
    const div = document.createElement("div");
    div.className = "boleto";

    const nums = generarOportunidades(i);
    nums.forEach(n => oportunidadesGlobal.push({ num: n, boleto: i }));

    const numeros = document.createElement("div");
    numeros.className = "numeros";
    numeros.textContent = nums.join(" ¬∑ ");

    const boton = document.createElement("button");
    boton.textContent = `Boleto #${String(i).padStart(3, '0')}`;
    boton.className = "disponible";
    boton.onclick = () => window.location.href = `registro.html?boleto=${i}`;
    boton.setAttribute("data-id", i);

    div.appendChild(numeros);
    div.appendChild(boton);
    panel.appendChild(div);
  }

  async function marcarEstadoBoletos() {
    const ref = collection(db, "boletos");
    const snap = await getDocs(ref);
    snap.forEach(doc => {
      const d = doc.data();
      const btn = document.querySelector(`button[data-id='${d.idboleto}']`);
      if (btn) {
        btn.className = d.estado === "pagado" ? "pagado" : "apartado";
        if (d.estado === "pagado") btn.disabled = true;
      }
    });
  }

  marcarEstadoBoletos();

  window.pedirClaveBNR = () => {
    const clave = prompt("Introduce la clave:");
    if (clave === "BNR") {
      const contador = {};
      for (let obj of oportunidadesGlobal) {
        contador[obj.num] = (contador[obj.num] || []);
        contador[obj.num].push(obj.boleto);
      }
      let repetidos = Object.entries(contador).filter(e => e[1].length > 1);
      const contenedor = document.getElementById("reporteRepetidos");
      contenedor.style.display = "block";
      if (repetidos.length === 0) {
        contenedor.innerHTML = "<h3>No se encontraron n√∫meros repetidos.</h3>";
        return;
      }
      let salida = "<h3>N√∫meros repetidos:</h3><ul>";
      for (let [numero, boletos] of repetidos) {
        salida += `<li>${numero} ‚Üí Boletos: ${boletos.map(b => "#" + String(b).padStart(3, '0')).join(", ")}</li>`;
      }
      salida += "</ul>";
      contenedor.innerHTML = salida;
    } else {
      alert("Clave incorrecta.");
    }
  };

  window.buscarNumero = () => {
    const n = prompt("¬øQu√© n√∫mero de la suerte buscas? (000‚Äì999)");
    const res = oportunidadesGlobal.filter(o => o.num === n);
    const contenedor = document.getElementById("busquedaResultado");
    if (res.length > 0) {
      const boletos = res.map(r => "#" + String(r.boleto).padStart(3, '0')).join(", ");
      contenedor.innerHTML = `<strong>‚úÖ El n√∫mero ${n} aparece en los siguientes boletos:</strong> ${boletos}`;
    } else {
      contenedor.innerHTML = `<strong>‚ùå El n√∫mero ${n} no est√° en ning√∫n boleto.</strong>`;
    }
    contenedor.style.display = "block";
  };
</script>
</body>
</html>