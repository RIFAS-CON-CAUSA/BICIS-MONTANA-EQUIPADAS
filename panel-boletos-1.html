<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Panel Boletos - Rifa Bicis</title>
  <style>
    body { font-family: Arial, sans-serif; background: #f5f5dc; padding: 20px; text-align: center; }

    .header { margin-bottom: 20px; }
    .boton { padding: 10px 15px; background: #4CAF50; color: white; text-decoration: none; border-radius: 5px; margin: 5px; display: inline-block; }

    .filtro { margin: 10px 0; }
    .buscador input { padding: 5px; width: 200px; }

    .boleto {
      border: 1px solid #ccc;
      border-radius: 5px;
      padding: 10px;
      margin: 5px;
      width: 160px;
      display: inline-block;
      vertical-align: top;
      text-align: center;
      background: #e0ffe0;
    }

    .apartado { background: #fff176 !important; }  /* Amarillo */
    .pagado { background: #81c784 !important; }    /* Verde */

    .agradecimiento { margin-top: 20px; font-weight: bold; font-size: 14px; }

    /* Responsive: 3 boletos por lÃ­nea en mÃ³viles */
    @media (max-width: 600px) {
      .boleto { width: calc(33.33% - 20px); box-sizing: border-box; }
      .buscador input { width: 100%; }
    }
  </style>
</head>
<body>

<div class="header">
  <a href="index.html" class="boton">â¬… Volver al inicio</a>
  <h2>ðŸ“‹ AquÃ­ tienes los 100 boletos</h2>
</div>

<div class="filtro">
  <button class="boton" onclick="filtrar('todos')">Todos</button>
  <button class="boton" onclick="filtrar('disponible')">ðŸŸ© Disponible</button>
  <button class="boton" onclick="filtrar('apartado')">ðŸŸ¨ Apartado</button>
  <button class="boton" onclick="filtrar('pagado')">ðŸŸ© Pagado</button>
</div>

<div class="buscador">
  <input type="number" id="busquedaNumero" placeholder="Buscar nÃºmero..." oninput="buscarNumero()">
</div>

<div id="boletos-container">Cargando boletos...</div>

<div class="agradecimiento">
  Gracias por tu apoyo al deporte y los jÃ³venes. Â¡MUCHA SUERTE!
</div>

<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/10.11.0/firebase-app.js";
  import { getFirestore, collection, getDocs } from "https://www.gstatic.com/firebasejs/10.11.0/firebase-firestore.js";

  const firebaseConfig = {
    apiKey: "AIzaSyC-9BVF6sfbA1IcmawTtxFiwHOyHv0Qa3g",
    authDomain: "rifas-con-causa.firebaseapp.com",
    projectId: "rifas-con-causa",
    storageBucket: "rifas-con-causa.firebasestorage.app",
    messagingSenderId: "347417635634",
    appId: "1:347417635634:web:3ddab8921d26707910452b"
  };

  const app = initializeApp(firebaseConfig);
  const db = getFirestore(app);

  let datosBoletos = [];

  async function cargarBoletos() {
    const container = document.getElementById('boletos-container');
    container.innerHTML = "Cargando...";

    const querySnapshot = await getDocs(collection(db, "boletos"));
    datosBoletos = [];

    querySnapshot.forEach((docSnap) => {
      const data = docSnap.data();
      data.docId = docSnap.id;
      datosBoletos.push(data);
    });

    datosBoletos.sort((a, b) => parseInt(a.idboleto) - parseInt(b.idboleto));
    pintarBoletos(datosBoletos);
  }

  function pintarBoletos(lista) {
    const container = document.getElementById('boletos-container');
    container.innerHTML = "";

    lista.forEach(data => {
      let numerosOrdenados = (data.numeros || []).sort((a, b) => parseInt(a) - parseInt(b));

      const div = document.createElement('div');
      div.className = 'boleto';
      if (data.estado === "apartado") div.classList.add('apartado');
      if (data.estado === "pagado") div.classList.add('pagado');

      div.innerHTML = `
        <strong>Boleto #${data.idboleto}</strong><br>
        <small>${numerosOrdenados.join(' - ')}</small>
      `;

      container.appendChild(div);
    });
  }

  function filtrar(estado) {
    if (estado === "todos") {
      pintarBoletos(datosBoletos);
    } else {
      const filtrados = datosBoletos.filter(b => (b.estado || "disponible") === estado);
      pintarBoletos(filtrados);
    }
  }

  function buscarNumero() {
    const valor = document.getElementById('busquedaNumero').value;
    if (!valor) {
      pintarBoletos(datosBoletos);
      return;
    }

    const filtrados = datosBoletos.filter(b => {
      return (b.numeros || []).some(num => num.includes(valor));
    });

    pintarBoletos(filtrados);
  }

  cargarBoletos();
</script>

</body>
</html>
