<script>
  document.getElementById("registroForm").addEventListener("submit", function(event) {
    event.preventDefault();

    const nombre = document.getElementById("nombre").value.trim();
    const telefono = document.getElementById("telefono").value.trim();
    const poblacion = document.getElementById("poblacion").value.trim();
    const boton = document.querySelector("button");

    // Desactivar botón para evitar múltiples clics
    boton.disabled = true;
    boton.textContent = "⏳ Procesando...";

    const urlParams = new URLSearchParams(window.location.search);
    const idboleto = urlParams.get('id');

    fetch("https://script.google.com/macros/s/AKfycbykd-_FQAOpWmbxl2yTPWWq_gQNbRcbXH5QkHtoI30DKbc-XTU6GtOaSzynMwSls6RZ/exec", {
      method: "POST",
      mode: "no-cors",
      headers: {
        "Content-Type": "application/json"
      },
      body: JSON.stringify({
        idboleto: idboleto,
        Nombre: nombre,
        Telefono: telefono,
        Poblacion: poblacion,
        Estado: "Apartado"
      })
    })
    .then(() => {
      alert(`✅ ¡Tu boleto #${idboleto} ha sido apartado correctamente!\nEl administrador revisará tu pago para confirmar.`);
      // Opcional: reiniciar formulario antes de redirigir
      document.getElementById("registroForm").reset();
      window.location.href = "panel-boletos-rifa.html";
    })
    .catch((error) => {
      console.error("Error al apartar:", error);
      alert("❌ Hubo un error al apartar tu boleto. Intenta de nuevo.");
      boton.disabled = false;
      boton.textContent = "📋 Apartar Boleto";
    });
  });
</script>
