<script>
  document.getElementById("registroForm").addEventListener("submit", function(event) {
    event.preventDefault();

    const nombre = document.getElementById("nombre").value.trim();
    const telefono = document.getElementById("telefono").value.trim();
    const poblacion = document.getElementById("poblacion").value.trim();
    const boton = document.querySelector("button");

    // ✅ Desactivar inmediatamente para evitar más clics
    boton.disabled = true;
    boton.textContent = "⏳ Enviando...";

    const urlParams = new URLSearchParams(window.location.search);
    const idboleto = urlParams.get('id');

    // ⚠️ Mantenemos no-cors porque estás en GitHub Pages
    fetch("https://script.google.com/macros/s/AKfycbykd-_FQAOpWmbxl2yTPWWq_gQNbRcbXH5QkHtoI30DKbc-XTU6GtOaSzynMwSls6RZ/exec", {
      method: "POST",
      headers: {
        "Content-Type": "application/json"
      },
      body: JSON.stringify({
        idboleto: idboleto,
        Nombre: nombre,
        Telefono: telefono,
        Poblacion: poblacion,
        Estado: "Apartado"
      }),
      mode: "no-cors"
    })
    .finally(() => {
      alert(`✅ ¡Tu boleto #${idboleto} ha sido apartado correctamente!\nEl administrador revisará tu pago para confirmar.`);
      document.getElementById("registroForm").reset();
      window.location.href = "panel-boletos-rifa.html";
    });
  });
</script>
